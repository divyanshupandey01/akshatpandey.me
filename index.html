<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Akshat Pandey</title>

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=Space+Grotesk:wght@600;700&display=swap" rel="stylesheet">

<style>
*{margin:0;padding:0;box-sizing:border-box;font-family:Inter,sans-serif}
body{background:#0b0b0b;color:#fff;display:flex;justify-content:center;padding:20px}
.container{max-width:900px;width:100%}
h1{font-family:Space Grotesk;font-size:3rem;text-align:center}
.card{background:#151515;border-radius:18px;padding:22px;margin:20px 0}
input,textarea{width:100%;padding:12px;border-radius:12px;border:none;margin-top:10px;background:#000;color:#fff}
button{margin-top:14px;padding:12px;border-radius:999px;border:none;background:#00ffcc;color:#000;font-weight:700;cursor:pointer}
.comment{background:#1c1c1c;border-radius:14px;padding:14px;margin-top:14px;position:relative}
.reply{margin-left:40px;margin-top:10px;background:#121212}
.user{display:flex;gap:10px;align-items:center;margin-bottom:6px}
.user img{width:36px;height:36px;border-radius:50%}
.badge{font-size:.7rem;background:#00ffcc;color:#000;padding:2px 6px;border-radius:6px;margin-left:6px}
small{opacity:.6;font-family:monospace}
.del{position:absolute;top:10px;right:10px;cursor:pointer}
.hidden{display:none}
</style>
</head>

<body>
<div class="container">

<h1>Akshat Pandey</h1>

<!-- AUTH -->
<div class="card" id="authBox">
  <h3>Sign Up / Login</h3>
  <input id="email" placeholder="Email (required)">
  <input id="password" type="password" placeholder="Password (required)">
  <input id="username" placeholder="Username (required)">
  <input id="pfp" type="file">
  <button onclick="authUser()">Continue</button>
</div>

<!-- COMMENT BOX -->
<div class="card hidden" id="commentBox">
  <h3>Drop a Comment</h3>
  <textarea id="commentText" placeholder="Write somethingâ€¦"></textarea>
  <button onclick="postComment()">Post</button>
</div>

<!-- COMMENTS -->
<div id="comments"></div>

</div>

<!-- FIREBASE -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-app.js";
import { 
  getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, onAuthStateChanged 
} from "https://www.gstatic.com/firebasejs/12.8.0/firebase-auth.js";
import {
  getFirestore, collection, addDoc, doc, getDoc, setDoc,
  query, orderBy, onSnapshot, serverTimestamp, deleteDoc
} from "https://www.gstatic.com/firebasejs/12.8.0/firebase-firestore.js";

const ADMIN_UID = "ADMIN_UID_PUT_YOURS_HERE";
const ADMIN_PFP = "https://i.postimg.cc/SKhqgHqv/IMG-20260111-212449-914.webp";

const firebaseConfig = {
  apiKey: "AIzaSyCY88mD-sHqxZiOGkQZbliTXG1QmySPesI",
  authDomain: "akshat-comments.firebaseapp.com",
  projectId: "akshat-comments"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

const authBox = document.getElementById("authBox");
const commentBox = document.getElementById("commentBox");
const commentsDiv = document.getElementById("comments");

/* AUTH */
window.authUser = async () => {
  const email = email.value;
  const password = password.value;
  const username = username.value;
  if(!email || !password || !username) return alert("All required");

  try{
    const res = await createUserWithEmailAndPassword(auth,email,password);
    await setDoc(doc(db,"users",res.user.uid),{
      username,
      pfp:"",
      created:serverTimestamp()
    });
  }catch{
    await signInWithEmailAndPassword(auth,email,password);
  }
};

/* AUTO LOGIN */
onAuthStateChanged(auth, async user=>{
  if(!user) return;
  authBox.classList.add("hidden");
  commentBox.classList.remove("hidden");
});

/* COMMENTS */
window.postComment = async ()=>{
  if(!commentText.value.trim()) return;
  await addDoc(collection(db,"comments"),{
    text:commentText.value,
    uid:auth.currentUser.uid,
    time:serverTimestamp(),
    replies:[]
  });
  commentText.value="";
};

onSnapshot(query(collection(db,"comments"),orderBy("time","desc")), async snap=>{
  commentsDiv.innerHTML="";
  for(const d of snap.docs){
    const c=d.data();
    const u=await getDoc(doc(db,"users",c.uid));
    const user=u.data();

    const div=document.createElement("div");
    div.className="comment";
    div.innerHTML=`
      <div class="user">
        <img src="${user?.pfp||'https://i.postimg.cc/3N1Z0vZy/user.png'}">
        <b>${user?.username}</b>
        ${c.uid===ADMIN_UID?'<span class="badge">ADMIN</span>':""}
      </div>
      <small>${new Date(c.time?.seconds*1000).toLocaleString()}</small>
      <p>${c.text}</p>
    `;
    commentsDiv.appendChild(div);
  }
});
</script>

</body>
</html>
