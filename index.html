<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Akshat Pandey</title>

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Space+Grotesk:wght@500;600;700&display=swap" rel="stylesheet">

<style>
/* --- EXISTING CSS (IMMUTABLE) --- */
*{margin:0;padding:0;box-sizing:border-box;font-family:'Inter',system-ui,sans-serif}

body{
  min-height:100vh;
  background:radial-gradient(circle at top,#111,#000);
  color:#fff;
  display:flex;
  justify-content:center;
  padding:20px;
}

.container{max-width:900px;width:100%;text-align:center}

.profile-pic{
  width:160px;height:160px;border-radius:50%;
  object-fit:cover;border:4px solid #00ffcc;
  margin:20px auto 10px;
}

.socials{display:flex;justify-content:center;gap:20px;margin-bottom:20px}
.socials img{width:32px;height:32px;cursor:pointer}

h1{
  font-family:'Space Grotesk',sans-serif;
  font-size:clamp(2.5rem,8vw,4rem);
}

.views{
  display:flex;justify-content:center;gap:8px;
  align-items:center;font-size:.95rem;opacity:.75;margin-top:6px;
}

.tagline{opacity:.85;margin:12px 0 30px}

.card{
  background:rgba(255,255,255,.06);
  border-radius:18px;
  padding:26px;
  margin-bottom:26px;
  text-align:left;
}

.btn{
  display:inline-block;margin-top:14px;padding:10px 20px;
  background:#00ffcc;color:#000;border-radius:999px;
  font-weight:700;text-decoration:none;
}

.comment-box h2{margin-bottom:18px}

textarea{
  width:100%;min-height:100px;background:#000;
  border:1px solid rgba(0,255,204,.45);
  border-radius:14px;padding:14px;color:#fff;
}

textarea::placeholder{color:#fff;font-weight:600}

.comment-btn{
  margin-top:14px;padding:10px 20px;
  background:#00ffcc;color:#000;border:none;
  border-radius:999px;font-weight:700;cursor:pointer;
}

.comments{margin-top:26px}

.comment{
  background:rgba(255,255,255,.08);
  border-radius:14px;
  padding:14px 14px 18px;
  margin-bottom:14px;
  font-size:.95rem;
  position:relative;
}

.comment small{
  opacity:.7;
  display:block;
  margin-bottom:4px;
  font-family:monospace;
}

.del{
  position:absolute;
  top:8px;
  right:8px;
  width:44px;
  height:44px;
  border-radius:50%;
  background:rgba(255,255,255,.18);
  display:flex;
  align-items:center;
  justify-content:center;
  cursor:pointer;
  z-index:10;
  touch-action:manipulation;
}

.del:active{
  transform:scale(0.92);
  background:rgba(255,107,107,.4);
}

.del img{
  width:20px;
  height:20px;
  pointer-events:none;
}

footer{margin-top:30px;font-size:.9rem;opacity:.65;text-align:center}

/* admin modal */
#adminModal{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.75);
  display:none;
  align-items:center;
  justify-content:center;
  z-index:999;
}
#adminBox{
  background:#111;
  width:90%;
  max-width:360px;
  padding:22px;
  border-radius:16px;
  text-align:center;
}
#adminBox input{
  width:100%;
  padding:10px;
  border-radius:10px;
  border:none;
  margin-bottom:14px;
}
#adminBox button{
  flex:1;
  padding:10px;
  border-radius:999px;
  border:none;
}

/* --- üöÄ NEW FEATURES CSS --- */
.user-header { display: flex; align-items: center; gap: 12px; margin-bottom: 8px; }
.user-avatar { width: 40px; height: 40px; border-radius: 50%; object-fit: cover; border: 2px solid #00ffcc; }
.user-info { display: flex; flex-direction: column; }
.user-name { font-weight: 700; font-size: 1rem; color: #fff; }
.user-handle { font-size: 0.8rem; opacity: 0.7; color: #00ffcc; }
.admin-badge { background: #00ffcc; color: #000; font-size: 0.7rem; padding: 2px 6px; border-radius: 4px; margin-left: 6px; font-weight: 800; vertical-align: middle; }

.reply-btn { background: transparent; border: 1px solid rgba(0,255,204,0.3); color: #00ffcc; padding: 4px 12px; border-radius: 99px; font-size: 0.8rem; cursor: pointer; margin-top: 10px; }
.replies-container { margin-top: 12px; padding-left: 14px; border-left: 2px solid rgba(255,255,255,0.1); }
.reply-input-box { display: none; margin-top: 10px; animation: fadeIn 0.3s ease; }
@keyframes fadeIn{from{opacity:0;transform:translateY(-5px)}to{opacity:1;transform:translateY(0)}}

/* Auth & Notify Modals */
.auth-modal { position: fixed; inset: 0; background: rgba(0,0,0,0.85); backdrop-filter: blur(5px); z-index: 1000; display: none; align-items: center; justify-content: center; }
.auth-card { background: #1a1a1a; width: 90%; max-width: 400px; padding: 24px; border-radius: 20px; border: 1px solid rgba(0,255,204,0.2); max-height: 90vh; overflow-y: auto; text-align: left; }
.auth-card h3 { margin-bottom: 16px; color: #00ffcc; text-align: center; }
.form-group { margin-bottom: 12px; text-align: left; }
.form-group label { font-size: 0.85rem; opacity: 0.8; display: block; margin-bottom: 4px; }
.form-group input { width: 100%; padding: 10px; background: #000; border: 1px solid #333; border-radius: 8px; color: #fff; }
.auth-btn { width: 100%; padding: 12px; background: #00ffcc; color: #000; font-weight: 700; border: none; border-radius: 99px; margin-top: 10px; cursor: pointer; }
.notify-trigger { background: rgba(0,255,204,0.1); border: 1px solid #00ffcc; color: #00ffcc; padding: 12px 20px; border-radius: 12px; margin-bottom: 20px; cursor: pointer; width: 100%; font-weight: 600; }
.notify-trigger:hover { background: #00ffcc; color: #000; }
</style>
</head>

<body>
<div class="container">

<img src="https://i.postimg.cc/SKhqgHqv/IMG-20260111-212449-914.webp" class="profile-pic">

<div class="socials">
  <a href="https://instagram.com/vedicash" target="_blank"><img src="https://i.postimg.cc/GmNvBpX1/instagram.png"></a>
  <a href="mailto:akshatpandey1307@gmail.com"><img src="https://i.postimg.cc/bNwn3nMZ/gmail.png"></a>
  <a href="https://www.linkedin.com/in/akshat-pandey-5b2a552a3" target="_blank"><img src="https://i.postimg.cc/764G7J79/linkedin.png"></a>
</div>

<h1>Akshat Pandey</h1>
<div class="views">üëÅÔ∏è <span id="viewCount">loading...</span> views</div>

<div class="tagline">Personal Landing Page</div>

<div class="card">
  Nigga this my landing page running on my personal server computer 24/7.
  <br><br>
  <a href="https://naturally-partial-wrote-scout.trycloudflare.com/a80cccda/instagram" target="_blank">
    https://naturally-partial-wrote-scout.trycloudflare.com/a80cccda/instagram
  </a><br>
  <a class="btn" href="https://naturally-partial-wrote-scout.trycloudflare.com/a80cccda/instagram">Go ‚Üí</a>
</div>

<button class="notify-trigger" onclick="openNotifyModal()">
  üîî Get Notified When Akshat Replies
</button>

<div class="card comment-box">
  <div id="welcomeMsg" style="margin-bottom:10px;color:#00ffcc;font-size:0.9rem;display:none;"></div>
  <h2>Drop a Comment</h2>
  <textarea id="commentInput" placeholder="Write something..."></textarea>
  <button class="comment-btn" onclick="handleMainComment()">Post Comment</button>
  <div class="comments" id="comments"></div>
</div>

<footer>¬© 2026 Akshat Pandey ‚Ä¢ Hosted On My Infrastructure</footer>
</div>

<div id="adminModal">
  <div id="adminBox">
    <h3>Admin Verification</h3>
    <p style="opacity:.75;font-size:.9rem;margin-bottom:14px">
      Please enter the Admin Passcode<br>
      If you are not admin please contact <a href="https://instagram.com/scionash" target="_blank" style="color:#00ffcc">@scionash</a>
    </p>
    <input id="adminPass" type="password" placeholder="Admin passcode">
    <div style="display:flex;gap:10px">
      <button onclick="closeAdmin()">Cancel</button>
      <button onclick="confirmAdminAction()" style="background:#ff6b6b;font-weight:700">Confirm</button>
    </div>
  </div>
</div>

<div id="signupModal" class="auth-modal">
  <div class="auth-card">
    <h3>üëã First Time Here?</h3>
    <p style="font-size:0.9rem;opacity:0.7;margin-bottom:15px;text-align:center;">Create a profile to comment globally.</p>
    <div class="form-group"><label>Full Name</label><input id="regName" type="text" placeholder="John Doe"></div>
    <div class="form-group"><label>Username (Unique)</label><input id="regUser" type="text" placeholder="@johnny"></div>
    <div class="form-group"><label>Email</label><input id="regEmail" type="email" placeholder="john@example.com"></div>
    <div class="form-group"><label>Password</label><input id="regPass" type="password" placeholder="******"></div>
    <div class="form-group"><label>Birthday</label><input id="regDob" type="date"></div>
    <div class="form-group"><label>Profile Photo URL (Optional)</label><input id="regPic" type="text" placeholder="https://..."></div>
    <div class="form-group"><label>Instagram ID (Optional)</label><input id="regInsta" type="text" placeholder="@john.doe"></div>
    <button class="auth-btn" onclick="submitSignup()">Create Identity</button>
    <button style="background:transparent;border:none;color:#aaa;margin-top:10px;cursor:pointer;width:100%" onclick="closeSignup()">Cancel</button>
  </div>
</div>

<div id="notifyModal" class="auth-modal">
  <div class="auth-card">
    <h3>üîî Get Updates</h3>
    <p style="font-size:0.9rem;opacity:0.7;margin-bottom:15px;text-align:center;">Enter email/social handle to get notified.</p>
    <input id="notifyContact" style="width:100%;padding:10px;border-radius:8px;border:none;margin-bottom:10px" placeholder="Email or Instagram Handle">
    <button class="auth-btn" onclick="saveNotification()">Subscribe</button>
    <button style="background:transparent;border:none;color:#aaa;margin-top:10px;cursor:pointer;width:100%" onclick="document.getElementById('notifyModal').style.display='none'">Close</button>
  </div>
</div>

<script type="module">
/* --- üõ†Ô∏è IMPORTS & INIT --- */
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-app.js";
import {
  getFirestore, collection, addDoc, query, orderBy, onSnapshot,
  deleteDoc, doc, serverTimestamp, getDoc, setDoc, updateDoc,
  increment, where, getDocs
} from "https://www.gstatic.com/firebasejs/12.8.0/firebase-firestore.js";

const firebaseConfig={
  apiKey:"AIzaSyCY88mD-sHqxZiOGkQZbliTXG1QmySPesI",
  authDomain:"akshat-comments.firebaseapp.com",
  projectId:"akshat-comments"
};

const app=initializeApp(firebaseConfig);
const db=getFirestore(app);

const ADMIN_KEY="@Akshat130807";
const ADMIN_PROFILE = {
  name: "Akshat Pandey",
  photo: "https://i.postimg.cc/SKhqgHqv/IMG-20260111-212449-914.webp",
  username: "@scionash",
  role: "admin"
};

/* --- üëÅÔ∏è VIEWS SYSTEM (With Error Check) --- */
const viewCount = document.getElementById("viewCount");
const viewRef = doc(db, "views", "counter");

async function updateViews(){
  try {
    const snap = await getDoc(viewRef);
    if(!snap.exists()){
      await setDoc(viewRef, {count:1});
      viewCount.textContent = "1";
    } else {
      await updateDoc(viewRef, {count: increment(1)});
      const u = await getDoc(viewRef);
      viewCount.textContent = u.data().count;
    }
  } catch(e) {
    console.error("View count error:", e);
    viewCount.textContent = "Error";
  }
}
updateViews();

/* --- üë§ USER STATE --- */
let currentUser = null;
let pendingAction = null;
let adminMode = false;

// Auto Login
async function autoLogin() {
  const uid = localStorage.getItem("akshat_uid");
  if(uid) {
    try {
      const snap = await getDoc(doc(db, "users", uid));
      if(snap.exists()) {
        currentUser = { ...snap.data(), uid: snap.id };
        updateWelcomeMsg();
      }
    } catch(e){ console.error("Auto login error", e); }
  }
}
autoLogin();

function updateWelcomeMsg() {
  const w = document.getElementById("welcomeMsg");
  if(currentUser || adminMode) {
    w.style.display = "block";
    const name = adminMode ? "Akshat (Admin)" : currentUser.name;
    w.innerHTML = `Logged in as <b>${name}</b>`;
  }
}

/* --- üè≥Ô∏è HELPERS --- */
function flag(code){
  if(!code) return "üè≥Ô∏è";
  return code.toUpperCase().replace(/./g,c=>String.fromCodePoint(127397+c.charCodeAt()));
}
async function getIP(){
  try{
    const r=await fetch("https://ipapi.co/json/");
    return await r.json();
  }catch{return {}}
}

/* --- üéÆ EXPOSING FUNCTIONS TO WINDOW (Crucial Fix) --- */

// 1. Notification Modal
window.openNotifyModal = () => {
  document.getElementById("notifyModal").style.display = "flex";
};

window.saveNotification = async () => {
  const val = document.getElementById("notifyContact").value;
  if(!val) return;
  try {
    await addDoc(collection(db, "notifications"), { contact: val, time: serverTimestamp() });
    alert("Subscribed!");
    document.getElementById("notifyModal").style.display = "none";
  } catch(e){ alert("Error subscribing"); }
};

// 2. Signup System
window.requireLogin = (action) => {
  if (currentUser || adminMode) {
    action();
  } else {
    pendingAction = action;
    document.getElementById("signupModal").style.display = "flex";
  }
};

window.closeSignup = () => {
  document.getElementById("signupModal").style.display = "none";
  pendingAction = null;
};

window.submitSignup = async () => {
  const name = document.getElementById("regName").value.trim();
  const username = document.getElementById("regUser").value.trim();
  const email = document.getElementById("regEmail").value.trim();
  const pass = document.getElementById("regPass").value;
  const dob = document.getElementById("regDob").value;
  const pic = document.getElementById("regPic").value.trim();
  const insta = document.getElementById("regInsta").value.trim();

  if(!name || !username || !email || !pass || !dob) return alert("Fill required fields!");

  const q = query(collection(db, "users"), where("username", "==", username));
  const snap = await getDocs(q);
  if(!snap.empty) return alert("Username taken!");

  try {
    const newUser = {
      name, username, email, password: pass, birthday: dob,
      photo: pic || "https://cdn-icons-png.flaticon.com/512/847/847969.png",
      instagram: insta, createdAt: serverTimestamp()
    };
    const docRef = await addDoc(collection(db, "users"), newUser);
    localStorage.setItem("akshat_uid", docRef.id);
    currentUser = { ...newUser, uid: docRef.id };
    
    closeSignup();
    updateWelcomeMsg();
    if(pendingAction) pendingAction();
  } catch(e) { alert("Error creating profile"); console.error(e); }
};

// 3. Comment System
window.handleMainComment = () => {
  const input = document.getElementById("commentInput");
  if(!input.value.trim()) return;
  
  window.requireLogin(async () => {
    const ip = await getIP();
    let identity = adminMode ? ADMIN_PROFILE : currentUser;

    await addDoc(collection(db, "comments"), {
      text: input.value,
      ip: ip.ip||"N/A", city: ip.city||"Unknown", region: ip.region||"Unknown",
      country: ip.country_name||"Unknown", flag: flag(ip.country),
      time: serverTimestamp(),
      userId: identity.uid || "admin",
      userName: identity.name,
      userHandle: identity.username,
      userPhoto: identity.photo,
      role: identity.role || "user"
    });
    input.value = "";
  });
};

// 4. Reply System
window.toggleReplyBox = (id) => {
  const box = document.getElementById(`reply-input-${id}`);
  box.style.display = box.style.display === "block" ? "none" : "block";
};

window.submitReply = (parentId) => {
  const txt = document.getElementById(`reply-text-${parentId}`);
  if(!txt.value.trim()) return;

  window.requireLogin(async () => {
    let identity = adminMode ? ADMIN_PROFILE : currentUser;
    await addDoc(collection(db, "comments", parentId, "replies"), {
      text: txt.value,
      time: serverTimestamp(),
      userId: identity.uid || "admin",
      userName: identity.name,
      userHandle: identity.username,
      userPhoto: identity.photo,
      role: identity.role || "user"
    });
    txt.value = "";
    document.getElementById(`reply-input-${parentId}`).style.display = "none";
  });
};

// 5. Admin System
let targetId=null, targetType=null, parentIdForReply=null;

window.openAdmin = (id, type, parentId = null) => {
  targetId = id; targetType = type; parentIdForReply = parentId;
  document.getElementById("adminModal").style.display = "flex";
};

window.closeAdmin = () => {
  document.getElementById("adminModal").style.display = "none";
  document.getElementById("adminPass").value = "";
};

window.confirmAdminAction = async () => {
  if(document.getElementById("adminPass").value !== ADMIN_KEY) return alert("Wrong passcode");
  
  // Activate Admin Mode
  if(!adminMode) {
    adminMode = true;
    updateWelcomeMsg();
    alert("Admin Mode Active");
  }

  // Delete Item
  try {
    if(targetType === 'comment') await deleteDoc(doc(db, "comments", targetId));
    else if(targetType === 'reply') await deleteDoc(doc(db, "comments", parentIdForReply, "replies", targetId));
    closeAdmin();
  } catch(e) { alert("Delete failed"); }
};

/* --- üîÑ RENDER LOOP --- */
const commentsDiv = document.getElementById("comments");
const q = query(collection(db,"comments"), orderBy("time","desc"));

onSnapshot(q, snap => {
  commentsDiv.innerHTML = "";
  snap.forEach(d => {
    const c = d.data();
    const t = c.time ? new Date(c.time.seconds*1000).toLocaleString() : "Just now";
    const uName = c.userName || "Anonymous";
    const uPhoto = c.userPhoto || "https://cdn-icons-png.flaticon.com/512/847/847969.png";
    const badge = c.role === "admin" ? `<span class="admin-badge">ADMIN</span>` : "";

    const div = document.createElement("div");
    div.className = "comment";
    div.innerHTML = `
      <div class="del" onclick="openAdmin('${d.id}', 'comment')">
        <img src="https://cdn-icons-png.flaticon.com/512/6861/6861362.png">
      </div>
      <div class="user-header">
        <img src="${uPhoto}" class="user-avatar">
        <div class="user-info">
          <span class="user-name">${uName} ${badge}</span>
          <span class="user-handle">${c.userHandle || ""}</span>
        </div>
      </div>
      <div style="margin:8px 0;font-size:1rem;line-height:1.4">${c.text}</div>
      <small>${c.flag} ${c.city} ‚Ä¢ ${t}</small>
      <button class="reply-btn" onclick="toggleReplyBox('${d.id}')">‚Ü© Reply</button>
      <div id="reply-input-${d.id}" class="reply-box reply-input-box">
        <textarea id="reply-text-${d.id}" placeholder="Reply..." style="width:100%;background:#111;color:#fff;border:1px solid #333;padding:8px;border-radius:8px;margin-bottom:8px"></textarea>
        <button class="comment-btn" style="padding:6px 14px;font-size:0.8rem" onclick="submitReply('${d.id}')">Post</button>
      </div>
      <div class="replies-container" id="replies-${d.id}"></div>
    `;
    commentsDiv.appendChild(div);

    // Load Replies
    const rRef = collection(db, "comments", d.id, "replies");
    onSnapshot(query(rRef, orderBy("time","asc")), rSnap => {
      const rDiv = document.getElementById(`replies-${d.id}`);
      if(rDiv) {
        rDiv.innerHTML = "";
        rSnap.forEach(rd => {
          const rc = rd.data();
          const rBadge = rc.role === "admin" ? `<span class="admin-badge">ADMIN</span>` : "";
          const replyEl = document.createElement("div");
          replyEl.style.marginTop="10px";
          replyEl.style.position="relative";
          replyEl.innerHTML = `
             <div class="del" style="width:24px;height:24px;top:0;right:0;background:rgba(255,255,255,0.1)" onclick="openAdmin('${rd.id}', 'reply', '${d.id}')">
               <img src="https://cdn-icons-png.flaticon.com/512/6861/6861362.png" style="width:12px;height:12px">
             </div>
             <div class="user-header" style="margin-bottom:4px">
               <img src="${rc.userPhoto}" class="user-avatar" style="width:28px;height:28px">
               <div class="user-info">
                 <span class="user-name" style="font-size:0.9rem">${rc.userName} ${rBadge}</span>
               </div>
             </div>
             <div style="font-size:0.95rem;opacity:0.9">${rc.text}</div>
          `;
          rDiv.appendChild(replyEl);
        });
      }
    });
  });
});
</script>
</body>
</html>
